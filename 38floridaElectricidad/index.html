<!DOCTYPE html>
<html lang="">
<head>
	<meta charset="UTF-8">
	<title>Untitled Document</title>
	<meta name="Author" content=""/>
	<link href="https://fonts.googleapis.com/css?family=Roboto:400 700" rel="stylesheet">
	<script src="http://cdn1.uvnimg.com/de/8b/bcc0a79549b0a3fd3d8f8df5a8f8/d3.v4.min.js"></script>
	<style>
	#boton{
		text-align: center;
	}
	#mapa{
		margin:0 auto;
		width:600px;
	}

	.mapa{
		fill:#516277;
		stroke-width: 1px;
		stroke: #a3a3a3;
	}

	.textoMapa{
		font-family: 'Roboto', sans-serif;
		font-weight: 800;
		font-style: normal;
		font-size: 13px;
		fill: #f7121f;
		stroke-width: 0px;
	}
	.sombraBlanca{
		fill: white;
		stroke: white;
		stroke-width: 1px;
	}
	.bolasMapa{
		fill: rgb(34, 66, 123);
		fill-opacity: 0.8;
		stroke: rgb(255, 255, 255);
		stroke-width: 1px;
	}
	.bolasMapa2{
		fill: rgb(14, 86, 13);
		fill-opacity: 0.8;
		stroke: rgb(255, 255, 255);
		stroke-width: 1px;
	}
	.textoBolas{
		fill:#ffffff;
		stroke: none;
		text-anchor: middle;
		font-size: 12px;
		font-family: Source Sans Pro;
	}

</style>
</head>
<body>

  <div id="tooltip" class="hidden">
        <p><strong>El valor es: </strong></p>
        <p><span id="value">100</span>%</p>
  </div>
    
	<p id="boton">Este párrafo cambiará los datos</p>
	<div id="mapa"></div>    


	<script type="text/javascript">
    //Width and height
    var w = 700;
    var h = 700;

			//Define map projection
			var projection = d3.geoMercator()
			.scale(4500)
		    .center([-83.8335315,27.798020802957016]) //projection center
		    .translate([w/2,h/2]) //translate to center the map in view

			//Define path generator
			var path = d3.geoPath()
			.projection(projection);

			//Create SVG element
			var svg = d3.select("#mapa")
			.append("svg")
			.attr("width", w)
			.attr("height", h)
			.classed("mapa", true);

			var grupoMapa = svg.append("g")
			.attr("width", w)
			.attr("height", h);

			var grupoMapa2 = svg.append("g")
			.attr("width", w)
			.attr("height", h);

			var scaleRadio = d3.scaleSqrt()
			.domain([0, 24])
			.range([0, 5]);

			//Carga el CSV de HISPANOS
			d3.csv("hispanic-counties.csv", function(data) {


				//Carga el GEOJSON de los condados 
				d3.json("floridaCounties.geojson", function(json) {


					//Función que une los datos del CSV y el mapa GEOJSON
					var unirDatos = function(){

						//Unir los datos de hispanos al GeoJSON
						//Loop through once for each ag. data value
						for (var i = 0; i < data.length; i++) {
							
							//Grab state name
							var dataCounty = data[i].countyName;
							
							
							//Grab data value, and convert from string to float
							var dataValue = parseFloat(data[i].porcentajeHispanics);
							

							//Find the corresponding state inside the GeoJSON
							for (var j = 0; j < json.features.length; j++) {
								

								var jsonCounty = json.features[j].properties.NAME;
								

								if (dataCounty == jsonCounty) {

									//Copy the data value into the JSON
									json.features[j].properties.value = dataValue;
									
									//Stop looking through the JSON
									break;
								}
							}
						};

					};
					//Función que pinta los círculos y los datos
					var pintarCirculos = function(){

						//Pintar Círculos
						grupoMapa.selectAll("circle")
						.data(json.features)
						.enter()
						.append("circle")
						.attr("cx", function (d,i){
							return path.centroid(d)[0]; })
						.attr("cy", function (d,i){ return path.centroid(d)[1]; })
						.attr("r", function(d){
							return scaleRadio(d.properties.value);})
						.classed("bolasMapa", true);



	          //Pintar cifra en bolas
	          grupoMapa.selectAll("text")
	          .data(json.features)
	          .enter()
	          .append("text")
	          .text(function(d){
	          	return d.properties.value;})
	          .attr("x", function (d,i){ return path.centroid(d)[0]; })
	          .attr("y", function (d,i){ return path.centroid(d)[1]; })
	          .attr("dy", 5)
	          .classed("textoBolas", true)
	          .attr("text-anchor" , "middle");
        	};

        	//Pinta todos las SUBESTACIONES Eléctricas de Florida
          d3.json("subestaciones.geojson", function(jsonMapa) {
          	console.log(jsonMapa.features[0].properties.LATITUDE)
          	grupoMapa2.selectAll("circle")
          	.data(jsonMapa.features)
          	.enter()
          	.append("circle")
          	.attr("cx", function(d){
          		console.log(d.properties.LATITUDE)
          		return projection([d.properties.LONGITUDE, d.properties.LATITUDE])[0];})
          	.attr("cy", function(d){
          		return projection([d.properties.LONGITUDE, d.properties.LATITUDE])[1];})
          	.attr("r", function(d){
          		return scaleRadio(d.properties.LINES);
          	})
          	.attr("fill", function(d){
          		if(d.properties.LINES < 15){
          			return "#5c72fd"
          		} else{return "red"};
          	})
          	.attr("stroke", "none");
          });


          //Pinta LINEAS ELÉCTRICAS
					d3.json("lineasElectricas.geojson", function(jsonMapa) {
          	grupoMapa2.selectAll("path")
					.data(jsonMapa.features)
					.enter()
					.append("path")
					.attr("d", path)
					.style("fill", "none")
					.style("stroke-width", 0.5)
					.style("stroke", "#242dfc");
          });



					//Pintar el mapa
					grupoMapa.selectAll("path")
					.data(json.features)
					.enter()
					.append("path")
					.attr("d", path)
					.style("fill", "#e6e6e6");
					unirDatos();
					
					//pintarCirculos();

				});		
			});

		</script>		
	</body>
	</html>